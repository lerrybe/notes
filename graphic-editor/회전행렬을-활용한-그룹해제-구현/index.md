# íšŒì „ í–‰ë ¬ì„ í™œìš©í•œ ê·¸ë£¹ í•´ì œ êµ¬í˜„

## ğŸ’¡ ë°°ê²½

- ìº”ë²„ìŠ¤ ê¸°ë°˜ ê·¸ë˜í”½ ì—ë””í„°ë¥¼ ê°œë°œí•˜ë‹¤ ë³´ë©´, ì—¬ëŸ¬ ê°ì²´ë¥¼ ê·¸ë£¹í™”í•˜ê³  í•´ì œí•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.
- íŠ¹íˆ ê·¸ë£¹ í•´ì œ ì‹œì—ëŠ” ê° ê°ì²´ì˜ ìœ„ì¹˜, í¬ê¸°, íšŒì „ ë“±ì˜ ë³€í™˜(transform) ì •ë³´ë¥¼ ì˜¬ë°”ë¥´ê²Œ ê³„ì‚°í•´ì•¼ í•©ë‹ˆë‹¤.
- ê·¸ë£¹ ë‚´ ê°ì²´ë“¤ì€ ë¶€ëª¨ ê·¸ë£¹ì„ ê¸°ì¤€ìœ¼ë¡œ í•œ ìƒëŒ€ì ì¸ ìœ„ì¹˜ì™€ ë³€í™˜ ê°’ì„ ê°€ì§€ê³  ìˆê³ , ê·¸ë£¹ì„ í•´ì œí•  ë•ŒëŠ” ì´ ìƒëŒ€ì ì¸ ê°’ë“¤ì„ ìº”ë²„ìŠ¤ì˜ ì ˆëŒ€ ì¢Œí‘œë¡œ ë³€í™˜í•´ì•¼ í•˜ë©°, ì´ ê³¼ì •ì—ì„œ íšŒì „ í–‰ë ¬(rotation matrix)ì„ í™œìš©í•˜ì—¬ ì˜¬ë°”ë¥´ê²Œ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- íŠ¹íˆ n-depthì˜ ê·¸ë£¹ì„ ì»¤ë²„í•˜ê¸° ìœ„í•´ í•´ë‹¹ ì‘ì—…ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

### 1. ê¸°ì¡´ ì½”ë“œì˜ ë¬¸ì œì 

- ë‹¨ìˆœíˆ ë¶€ëª¨ì˜ ìœ„ì¹˜ì— ìƒëŒ€ ìœ„ì¹˜ë¥¼ ë”í•˜ëŠ” ë°©ì‹
- íšŒì „ì´ ìˆì„ ë•Œ ì¢Œí‘œê³„ê°€ íšŒì „ëœë‹¤ëŠ” ê²ƒì„ ê³ ë ¤í•˜ì§€ ì•ŠìŒ
- ê²°ê³¼ì ìœ¼ë¡œ íšŒì „ëœ ê·¸ë£¹ ë‚´ì˜ ê°ì²´ë“¤ì´ ì˜ëª»ëœ ìœ„ì¹˜ì— ë°°ì¹˜ë¨

### **2. ìƒˆ ì½”ë“œì˜ í•´ê²° ë°©ë²•**

- íšŒì „ í–‰ë ¬ì„ ì‚¬ìš©í•˜ì—¬ ì¢Œí‘œê³„ ë³€í™˜ì„ ì •í™•í•˜ê²Œ ì²˜ë¦¬
- ë¶€ëª¨ ê·¸ë£¹ì˜ íšŒì „ì„ ê³ ë ¤í•˜ì—¬ ìì‹ ê°ì²´ì˜ ìœ„ì¹˜ë¥¼ ê³„ì‚°

## ğŸ’¡ êµ¬í˜„ ì›ë¦¬

### 1. ë³€í™˜ ê³„ì‚°ì˜ ê¸°ë³¸ ê°œë…

- ê·¸ë£¹ í•´ì œ ì‹œ ê° ê°ì²´ì˜ ìµœì¢… ìœ„ì¹˜ì™€ ë³€í™˜ê°’ì„ ê³„ì‚°í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒ ì„¸ ê°€ì§€ ìš”ì†Œë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤:
  - ìœ„ì¹˜ (x, y): ê°ì²´ê°€ ë Œë”ë˜ëŠ” ê¸°ì¤€ ì¢Œí‘œ
  - í¬ê¸° (scaleX, scaleY): ê°ì²´ì˜ ê°€ë¡œ/ì„¸ë¡œ ë°°ìœ¨
  - íšŒì „ (rotation): ê°ì²´ì˜ íšŒì „ ê°ë„

### 2. íšŒì „ í–‰ë ¬ì˜ í™œìš©

íšŒì „ëœ ì¢Œí‘œë¥¼ ê³„ì‚°í•  ë•ŒëŠ” 2D íšŒì „ í–‰ë ¬ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. íšŒì „ í–‰ë ¬ì˜ ìˆ˜ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

```
x' = xâ‚€ + (x * cos Î¸ - y * sin Î¸)
y' = yâ‚€ + (x * sin Î¸ + y * cos Î¸)
```

ì—¬ê¸°ì„œ:

- xâ‚€, yâ‚€: íšŒì „ ì¤‘ì‹¬ì  (ë¶€ëª¨ ê·¸ë£¹ì˜ ê¸°ì¤€ ì¢Œí‘œ)
- x, y: ì›ë³¸ ì¢Œí‘œ
- Î¸: íšŒì „ ê°ë„ (ë¼ë””ì•ˆ)
- x', y': íšŒì „ í›„ì˜ ìƒˆë¡œìš´ ì¢Œí‘œ

### 3. ë³€í™˜ ìˆœì„œ

ê°ì²´ì˜ ìµœì¢… ìœ„ì¹˜ë¥¼ ê³„ì‚°í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. ë¶€ëª¨ ê·¸ë£¹ ë‚´ì—ì„œì˜ ìƒëŒ€ ìœ„ì¹˜ì— ìŠ¤ì¼€ì¼ ì ìš©
2. íšŒì „ í–‰ë ¬ì„ ì‚¬ìš©í•˜ì—¬ íšŒì „ ë³€í™˜ ì ìš©
3. ë¶€ëª¨ ê·¸ë£¹ì˜ ìœ„ì¹˜ë¥¼ ë”í•˜ì—¬ ì ˆëŒ€ ì¢Œí‘œ ê³„ì‚°
4. í¬ê¸°ì™€ íšŒì „ ê°ë„ì˜ ëˆ„ì  ê°’ ê³„ì‚°

## ğŸ’¡Â ì½”ë“œ êµ¬í˜„

- _íšŒì „ ë³€í™˜ê³¼ ê´€ë ¨ëœ ì½”ë“œë§Œì„ ì²¨ë¶€í•©ë‹ˆë‹¤._

```tsx
/**
 ğŸ“ /ungroup-nodes-controller.ts
*/

private _addChildNodes = (
  frame: Frame,
  node: Node,
  parentTransform: {
    x: number
    y: number
    scaleX: number
    scaleY: number
    rotation: number
  }
): Node[] => {
  // 1. íšŒì „ ê°ë„ë¥¼ ë¼ë””ì•ˆìœ¼ë¡œ ë³€í™˜
  const angleInRadians = (parentTransform.rotation * Math.PI) / 180

  // 2. ìƒëŒ€ ìœ„ì¹˜ ê³„ì‚°
  const relativeX = node.x() * parentTransform.scaleX
  const relativeY = node.y() * parentTransform.scaleY

  // 3. íšŒì „ í–‰ë ¬ì„ ì‚¬ìš©í•˜ì—¬ ì ˆëŒ€ ì¢Œí‘œ ê³„ì‚°
  // íšŒì „ í–‰ë ¬ ê³µì‹:
  // x' = xâ‚€ + (x * cos Î¸ - y * sin Î¸)
  // y' = yâ‚€ + (x * sin Î¸ + y * cos Î¸)
  // xâ‚€, yâ‚€: íšŒì „ ì¤‘ì‹¬ì  (ë¶€ëª¨ ê·¸ë£¹ì˜ ì¤‘ì‹¬)
  // https://en.wikipedia.org/wiki/Rotation_matrix
  const absoluteX =
    parentTransform.x +
    (relativeX * Math.cos(angleInRadians) - relativeY * Math.sin(angleInRadians))
  const absoluteY =
    parentTransform.y +
    (relativeX * Math.sin(angleInRadians) + relativeY * Math.cos(angleInRadians))

  // 4. ìµœì¢… ë³€í™˜ ê°’ ê³„ì‚°
  const finalScaleX = parentTransform.scaleX * node.scaleX()
  const finalScaleY = parentTransform.scaleY * node.scaleY()
  const finalRotation = parentTransform.rotation + node.rotation()

  // 5. ìƒˆë¡œìš´ ë…¸ë“œ ìƒì„±
  return nodeAdder({
    frame,
    type: node.attrs.type,
    config: {
      ...node.attrs,
      x: absoluteX,
      y: absoluteY,
      scaleX: finalScaleX,
      scaleY: finalScaleY,
      rotation: finalRotation,
    }
  })
}

```

## ğŸ’¡ êµ¬í˜„ ì‹œ ì£¼ì˜ì‚¬í•­

1. **ê°ë„ ë‹¨ìœ„ ë³€í™˜**
   - KonvaëŠ” íšŒì „ ê°ë„ë¥¼ ë„(degree) ë‹¨ìœ„ë¡œ ì‚¬ìš©
   - íšŒì „ í–‰ë ¬ ê³„ì‚° ì‹œì—ëŠ” ë¼ë””ì•ˆ(radian) ë‹¨ìœ„ í•„ìš”
   - `degree * (Ï€/180)` ê³µì‹ìœ¼ë¡œ ë³€í™˜
2. **ë³€í™˜ ìˆœì„œ**
   - ìŠ¤ì¼€ì¼ â†’ íšŒì „ â†’ ì´ë™ ìˆœì„œë¡œ ì ìš©
   - ìˆœì„œê°€ ë°”ë€Œë©´ ì›í•˜ëŠ” ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•ŠìŒ
3. **ëˆ„ì  ë³€í™˜**
   - ìŠ¤ì¼€ì¼: ë¶€ëª¨ì™€ ìì‹ì˜ ê°’ì„ ê³±í•˜ì—¬ ëˆ„ì 
   - íšŒì „: ë¶€ëª¨ì™€ ìì‹ì˜ ê°ë„ë¥¼ ë”í•˜ì—¬ ëˆ„ì 
   - ìœ„ì¹˜: íšŒì „ í–‰ë ¬ì„ í†µí•´ ê³„ì‚°ëœ ì ˆëŒ€ ì¢Œí‘œ ì‚¬ìš©
4. **ì¬ê·€ì  ì²˜ë¦¬**
   - ì¤‘ì²©ëœ ê·¸ë£¹ì˜ ê²½ìš° ì¬ê·€ì ìœ¼ë¡œ ì²˜ë¦¬
   - ê° ê³„ì¸µì˜ ë³€í™˜ê°’ì„ ì˜¬ë°”ë¥´ê²Œ ëˆ„ì í•´ì•¼ í•¨

## ğŸ’¡ ë ˆí¼ëŸ°ìŠ¤

- https://en.wikipedia.org/wiki/Rotation_matrix
- https://www.cs.helsinki.fi/group/goa/mallinnus/3dtransf/3drot.html
